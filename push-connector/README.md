# Push Connector

**NOTE:** 部署时注意kiev-server.xml更新导致的无法预知的错误

## 通讯协议设计
推送服务与客户端交互统一采用的协议，协议主要包括消息头与消息体.对于不同的设备可以适当采取合适的鉴权协议

### 消息头
* 标识位 0xf8 代表推送协议开始
* 版本号 代表协议版本号，供以后升级判断使用
* 信令类型  
订阅，心跳，推送
* 消息体长度 2个字节存储消息体长度
* 附加信息  
加密，压缩算法

### 二进制协议
消息头暂时是5个byte
第一个字节代表信令类型，接着四个个字节代表body消息体长度

### 消息体
消息体主要是指在不同信令类型，消息体所装载的数据，这里字段暂时使用json格式，由各个类型的信令自行决定具体的消息格式


## 心跳格式
* 消息体格式
```json
{"interval":30 //单位为s}
```


## 基本功能
* 提供根据唯一id的RPC统一推送接口
* 提供维护各个链接的接口
* 用于维护与客户端的链接，在建立链接后，用唯一id标识该链接
* 链接网关尽量逻辑简单，只提供链接功能，维护客户端的链接关系，对于群组的维护可以在推送业务层去处理

**NOTE:** 除此之外服务connect将转请求至相关的服务，例如订阅服务，群组服务,消息缓存服务

## 需求分析
> 集群模式如何给单个用户推送消息  
  
因为不同用户可能链接不同的push-connector,所以推送的时候首先要找到这个用户所链接的connector，然后再向其推送消息

> 群推送  
  
给某一用户组推送，可以根据用户id找到其所在的网络，然后在调远程接口进行推送，这种方式需要维护一个链接关系表

> 消息发布订阅模型  
  
客户端与connector的映射关系可以在redis中维护，可以采用redis的发布订阅模型通知其他connector进行后续操作
