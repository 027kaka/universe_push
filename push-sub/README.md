# 订阅服务
此服务实际为推送的基础服务，用户生成当前用户的唯一token，该服务将作为微服务发布
设备接入原则上是不需要任何参数的，但是为了以后能够迅速找到与该设备对应的channel通道，需要一个唯一的链接标识用于标识这个链接。

## 订阅协议说明

> 请求消息体为空

````json
{"uid":""}
````
* __无uid上报模式__
实际情况下，在当前链接不断的情况下，用户生成的token是不会发生变化的，在订阅生成token后，由用户自己上报给自己的业务系统，但是在每次下线后，需要将新的token上报给业务系统
* __uid上报模式__
`uid`可以时设备唯一标志，也可以时用户名称id唯一标志，例如手机设备上，同一手机只存在同一链接，可以用`imei`标志，如果同一手机存在不同链接可以使用用户id标志
用户id可以来自其他业务系统，比如用户系统，上报用户id

> 响应格式

```json
{"status":200,"token":"服务端返回的推送token，全局唯一，标识用户的唯一链接"}
```

# 需求问题分析
> 全局唯一id生成方案  

需要根据当前用户生成唯一token，以标记不同用户的链接

> 设备唯一性标志与token生成规则  

用户重复订阅会产生不同的token，这种方式与实际有些冲突，原则上token与用户id可以关联，减少token上报的复杂程度

> 用户id与token存储问题

同一用户在反复订阅时，应该返回同一个token，此时需要存储用户id与token的对应关系

## 参考资料

* [分布式唯一ID的几种生成方案](https://juejin.im/post/5b3a23746fb9a024e15cad79)